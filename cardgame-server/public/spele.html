<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8" />
  <title>Istaba</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: sans-serif; }
    #dalibnieki { margin-top: 20px; }
    #joinBtn { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Istaba: <span id="istabaID"></span></h2>
  <h3 id="roomName"></h3>

  <!-- Join button: hidden once youâ€™re a member -->
  <button id="joinBtn">Pievienoties istabai</button>

  <h3>DalÄ«bnieki:</h3>
  <ul id="dalibnieki"></ul>

  <h3>ÄŒats</h3>
  <div id="Äats-log" style="border:1px solid #ccc; height:150px; overflow:auto; padding:5px;"></div>
  <input type="text" id="Äats-ievade" placeholder="Raksti ziÅ†ojumuâ€¦" />
  <button id="Äats-sÅ«tÄ«t">SÅ«tÄ«t</button>

  <script>
    const socket = io();
    const istabaID = location.pathname.split('/').pop();
    document.getElementById('istabaID').innerText = istabaID;

    const joinBtn = document.getElementById('joinBtn');
    const nameH3 = document.getElementById('roomName');
    const ul = document.getElementById('dalibnieki');

    // Ask server for room info when page loads
    socket.emit('spele-page-load', istabaID);

    // Room â€œstatsâ€ arrives: name, creator, current members
    socket.on('istabas-stats', ({ nosaukums, izveidotajs, dalibnieki }) => {
      nameH3.innerText = nosaukums;
      updateMembers(dalibnieki);

      // Hide join button if Iâ€™m already in the room
      if (dalibnieki.includes(socket.id)) {
        joinBtn.style.display = 'none';
      } else {
        joinBtn.style.display = 'inline-block';
      }
    });

    // Click to join
    joinBtn.addEventListener('click', () => {
      socket.emit('pievienoties-istabai', istabaID);
    });

    // Confirmation of join
    socket.on('pievienots', () => {
      joinBtn.style.display = 'none';
    });
    socket.on('pievienots', (data) => {
  console.log('ðŸŽ‰ pieveinots event data:', data);
  // Now that you know exactly whatâ€™s arriving, format your alert:
  const msg = data.nosaukums
    ? `Pievienots: ${data.nosaukums} (${data.id})`
    : `Pievienots: ${data.id}`;
  alert(msg);
  joinBtn.style.display = 'none';
});

    // Whenever someone joins, update the list
    socket.on('jauns-dalibnieks', ({ dalibnieki }) => {
      updateMembers(dalibnieki);
    });

    // Error handling
    socket.on('kÄ¼Å«da', msg => alert(msg));

    function updateMembers(list) {
      ul.innerHTML = '';
      list.forEach((sid, idx) => {
        const li = document.createElement('li');
        li.innerText = `AnonÄ«ms #${idx+1}` + (sid === izveidotajs ? ' (ÄªpaÅ¡nieks)' : '');
        ul.appendChild(li);
      });
      // ÄŒats UI elementi
const ÄatsLog    = document.getElementById('Äats-log');
const ÄatsIevade = document.getElementById('Äats-ievade');
const ÄatsPoga   = document.getElementById('Äats-sÅ«tÄ«t');

// SÅ«tÄ«t ziÅ†ojumu uz serveri
ÄatsPoga.addEventListener('click', () => {
  const txt = ÄatsIevade.value.trim();
  if (!txt) return;
  socket.emit('chat-msg', { istabaID, ziÅ†ojums: txt });
  ÄatsIevade.value = '';
});

// SaÅ†emt ziÅ†ojumu no servera un ielogot
socket.on('chat-msg', ({ from, ziÅ†ojums, laiks }) => {
  const rinda = document.createElement('div');
  // PÄrveido socket.id uz anonÄ«mu #n, ja vÄ“lies
  rinda.innerText = `${from}: ${ziÅ†ojums}`;
  ÄatsLog.appendChild(rinda);
  // Scroll uz leju
  ÄatsLog.scrollTop = ÄatsLog.scrollHeight;
});
socket.on('pievienots', () => {
    console.log('Pievienojies istabai', istabaID);
  });
    }
  </script>
</body>
</html>
